CREATE OR REPLACE PACKAGE payroll.pkg_payroll AS\n  PROCEDURE RUN_MONTHLY_PAYROLL(p_month VARCHAR2, p_created_by VARCHAR2 := 'system');\n  PROCEDURE CALCULATE_EMP_PAY(p_emp_id NUMBER, p_run_id NUMBER);\nEND pkg_payroll;\n/\n\nCREATE OR REPLACE PACKAGE BODY payroll.pkg_payroll AS\n\n  -- Helper: simple tax calc (sample progressive slab simplified)\n  FUNCTION calc_tax(p_gross NUMBER) RETURN NUMBER IS\n    v_tax NUMBER := 0;\n  BEGIN\n    IF p_gross <= 250000 THEN\n      v_tax := 0;\n    ELSIF p_gross <= 500000 THEN\n      v_tax := (p_gross - 250000) * 0.05;\n    ELSIF p_gross <= 1000000 THEN\n      v_tax := 12500 + (p_gross - 500000) * 0.2;\n    ELSE\n      v_tax := 112500 + (p_gross - 1000000) * 0.3;\n    END IF;\n    RETURN ROUND(v_tax,2);\n  END calc_tax;\n\n  PROCEDURE CALCULATE_EMP_PAY(p_emp_id NUMBER, p_run_id NUMBER) IS\n    v_basic NUMBER;\n    v_hra NUMBER;\n    v_da NUMBER;\n    v_gross NUMBER;\n    v_pf NUMBER;\n    v_tax NUMBER;\n    v_net NUMBER;\n  BEGIN\n    SELECT basic_pay, hra_percent, da_percent, pf_percent INTO v_basic, v_hra, v_da, v_pf FROM employees WHERE emp_id = p_emp_id;\n\n    v_hra := ROUND(v_basic * (v_hra/100),2);\n    v_da  := ROUND(v_basic * (v_da/100),2);\n\n    v_gross := v_basic + v_hra + v_da;\n\n    v_pf := ROUND((v_basic * (v_pf/100)),2);\n    v_tax := calc_tax(v_gross*12) / 12; -- annual tax simplified divided monthly\n\n    v_net := v_gross - (v_pf + v_tax);\n\n    INSERT INTO salary_details(run_id, emp_id, gross_salary, total_deductions, net_salary, tax, pf)\n    VALUES (p_run_id, p_emp_id, v_gross, (v_pf + v_tax), v_net, v_tax, v_pf);\n\n    COMMIT;\n  EXCEPTION\n    WHEN NO_DATA_FOUND THEN\n      NULL; -- employee not found\n  END CALCULATE_EMP_PAY;\n\n  PROCEDURE RUN_MONTHLY_PAYROLL(p_month VARCHAR2, p_created_by VARCHAR2 := 'system') IS\n    v_run_id NUMBER;\n  BEGIN\n    INSERT INTO salary_runs(run_month, created_by) VALUES (p_month, p_created_by) RETURNING run_id INTO v_run_id;\n\n    FOR rec IN (SELECT emp_id FROM employees WHERE is_active = 'Y') LOOP\n      CALCULATE_EMP_PAY(rec.emp_id, v_run_id);\n    END LOOP;\n  END RUN_MONTHLY_PAYROLL;\n\nEND pkg_payroll;\n/\n